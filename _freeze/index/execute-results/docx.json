{
  "hash": "eb3cbef0308ea03404cc5bd7f45fef53",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Supplementary Materials to the Manuscript: Combining temperate fruit tree cultivars to fit spring phenology models\"\nauthors:\n    - name: Lars Caspersen\n      orcid: 0009-0000-3057-7327\n      affil-id: 1\n      affiliation:\n        - ref: hortibonn\n      email: lcaspers@uni-bonn.de\n      corresponding: true\n    - name: Katja Schiffers\n      orcid: 0000-0003-2559-6579\n      affil-id: 1\n      affiliation:\n        - ref: hortibonn\n    - name: Katherine Jarvis-Shean\n      orcid: 0000-0001-7097-0625\n      affil-id: 2\n      affiliation:\n        - ref: ucdavis\n    - name: Eike Luedeling\n      orcid: 0000-0002-7316-3631\n      affil-id: 1\n      affiliation:\n        - ref: hortibonn\n      \naffiliations:\n  - id: hortibonn\n    name: Department of Horticultural Sciences, Institue of Crop Science and Resource Conservation (INRES), University of Bonn, Auf dem Hügel 6, 53121 Bonn, Germany\n  - id: ucdavis\n    name: University of California, Division of Agriculture and Natural Resources,70 Cottonwood St, Woodland, CA 95695, USA\n    \nkeywords:\n  - dormancy\n  - model calibration\n  - data-scarcity\n  - almond\n  - phenology\n  - flowering\nabstract: >\n  Phenological datasets for temperate fruit trees are often short , fragmented and geographically restricted, which hampers the development of cultivar-specific spring phenology models. To address this, we propose a novel calibration approach (“combined-fitting”), which pools observations from several cultivars of the same species, distinguishing between shared and cultivar-specific parameters. This method requires fewer observations per cultivar and allows jointly analyzing cultivars of the same species. We evaluate combined-fitting using the PhenoFlex framework, comparing it to a baseline model and to models that are fitted only with data for single cultivars (“cultivar-fit”). Our analysis is based on flowering data from nine almond, six apricot and six sweet cherry cultivars across Mediterranean (Spain, Morocco, Tunisia) and German climates. The combined-fit model failed to achieve higher prediction accuracy compared to the cultivar-fit and the baseline approach, as evidenced by similar root mean square errors across the data splits and calibration dataset sizes. When comparing the estimated parameters of the chill and heat accumulation submodels, we observed a large variation among cultivars of the same species in the cultivar-fit models. In contrast and by design, the combined-fit yielded only one parameter set for cultivars of the same species. Our findings demonstrate that integrating data from multiple cultivars can yield spring phenology models with high accuracy. Even though the combined-fit approach did not outperform the cultivar-fit approach, combined-fitting offers a practical solution for spring phenology modeling with limited datasets and facilitates comparison across cultivars of the same species.\ndate: last-modified\nbibliography: references.bib\ncitation:\n  container-title: International Journal of Biometeorology\nnumber-sections: true\n---\n\n\n\n\n\n\n## Introduction\n\nThis document contains supplementary materials for the journal article: *Combining temperate fruit tree cultivar to fit spring phenology models*. It includes additional tables and files that were not part of the main article, as well as the code to replicate the analyses.\n\nThe phenology analyzed here are part of a long-term phenology dataset [@luedeling_long-term_2024] compiled within the *Adapting Mediterranean Orchards (AdaMedOr)* project. Of the more than 270 cultivars in the dataset, a subset of 110 cultivars has been analyzed by @caspersen_contrasting_2025 using the PhenoFlex framework [@luedeling_phenoflex_2021], available via the R package *chillR* [@luedelingChillRStatisticalMethods2024]. In addition to model calibration, the analysis includes climate change impact projections on future bloom dates.\n\nMore than 50% of the cultivars in the dataset were not analyzed because the bloom observations were considered too short for calibration with PhenoFlex. We propose an alternative calibration method, **combine- fitting**, which reduces the number parameters estimated per cultivar and may allow the joint analysis of cultivars of the same fruit tree species. We evaluate combined-fit approach for three temperate fruit and nut species (almond, apricot, sweet cherry) and compare the results with those from a baseline model and from a common calibration approach in which each cultivar is calibrated seperately. We perform the analysis for the full dataset and for an artificially shortened dataset.\n\nParts of the function that we present in this document are available via the R packages *evalpheno* [@caspersen_evalpheno_2025] and *LarsChill* [@caspersen_larschill_2025]. Both packages are currently available via GitHub.\n\n## Supplementary Table\n\n\n\n\n\n\n::: {.cell tbl-cap='Table S1. Overview on the full bloom dataset for almond, apricot and sweet cherry cultivars'}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nmaster <- read.csv('notebooks/data/master_all.csv')\n\nmaster %>% \n  mutate(country = case_when(\n    location == 'Meknes' ~ 'Morocco',\n    location == 'Sfax' ~ 'Tunisia',\n    location %in% c('Zaragoza', 'Cieza', 'Santomera') ~ 'Spain',\n    location == 'Klein-Altendorf' ~ 'Germany'\n  )) %>% \n  mutate(Species = species,\n         Location = location, \n         Country = country,\n         Cultivar = cultivar) %>% \n  filter(ncal == 'full') %>% \n  group_by(Species, Location, Country, Cultivar) %>% \n  summarise(`Year Start` =   min(year),\n            `Year End` =  max(year),\n            n = n()) %>% \n  knitr::kable()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'Species', 'Location', 'Country'. You can\noverride using the `.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n\n|Species      |Location        |Country |Cultivar    | Year Start| Year End|  n|\n|:------------|:---------------|:-------|:-----------|----------:|--------:|--:|\n|Almond       |Meknes          |Morocco |Ferragnes   |       1977|     2014| 38|\n|Almond       |Meknes          |Morocco |Marcona     |       1977|     2014| 38|\n|Almond       |Meknes          |Morocco |Tuono       |       1974|     2014| 41|\n|Almond       |Santomera       |Spain   |Achaak      |       1997|     2019| 13|\n|Almond       |Santomera       |Spain   |Desmayo     |       1997|     2022| 21|\n|Almond       |Santomera       |Spain   |Marta       |       2005|     2021| 14|\n|Almond       |Sfax            |Tunisia |Fasciuneddu |       1981|     2015| 22|\n|Almond       |Sfax            |Tunisia |Mazzetto    |       1981|     2015| 22|\n|Almond       |Sfax            |Tunisia |Nonpareil   |       1981|     2016| 23|\n|Apricot      |Cieza           |Spain   |Bulida      |       2003|     2022| 21|\n|Apricot      |Cieza           |Spain   |Dorada      |       2003|     2022| 20|\n|Apricot      |Zaragoza        |Spain   |Goldrich    |       1999|     2021| 21|\n|Apricot      |Zaragoza        |Spain   |Harcot      |       1999|     2022| 22|\n|Apricot      |Zaragoza        |Spain   |Henderson   |       1999|     2021| 21|\n|Apricot      |Zaragoza        |Spain   |Sunglo      |       1999|     2022| 22|\n|Sweet Cherry |Klein-Altendorf |Germany |Burlat      |       1978|     2015| 29|\n|Sweet Cherry |Klein-Altendorf |Germany |Regina      |       1988|     2020| 32|\n|Sweet Cherry |Klein-Altendorf |Germany |Schneiders  |       1984|     2019| 32|\n|Sweet Cherry |Zaragoza        |Spain   |Rainier     |       1991|     2022| 24|\n|Sweet Cherry |Zaragoza        |Spain   |Sam         |       1991|     2022| 24|\n|Sweet Cherry |Zaragoza        |Spain   |Van         |       1991|     2022| 24|\n\n\n:::\n:::\n\n\n\n\n\n\n## Supplementary Figure\n\n![Figure S1. Root Mean Square Error (RMSE, days) of predicted bloom dates for each species (almond, apricot, sweet cherry) and cultivar (indicated at the x-axis). Boxplot summarizes RMSE for calibration and validation split and for ‘scarce’ and ‘full’ calibration sets. Calibration methods are indicated by color, green for ‘Baseline Model’, yellow for ‘Cultivar-Fit’ and blue for 'Combined-Fit’.](images/rmse_slim_bycultivar.jpeg)\n\n## Supplementary Code\n\n### Data splitting\n\nThis notebook shows the preparation of the phenology data. Performs calibration and validation data splits. Check out the notebook for more details:\n\n[Split data in calibration and validation](https://larscaspersen.github.io/combined-fitting-bloom/notebooks/01-prepare-phenology.html)\n\n### Model Calibration\n\nWhen calibrating the model, we specified the search space for each model parameter. We substituted the model parameters E~0~, E~1~, A~0~ and A~1~ of the chill submodel with intermediate parameters $\\theta^*$ , $\\theta_c$ , $\\pi_c$ and $\\tau$ , following @egea_reducing_2021 and implemented for PhenoFlex by @caspersen2024. Additionally, we restricted parameters, so that the `E10` quotient of the process modeling chill formation and degradation ranges between 1.5 and 3.5, a range said to be realistic in biological systems [@egea_reducing_2021; @luedeling_phenoflex_2021]. During model calibration, the optimization algorithm ran for 5,000 iterations for baseline model; 30,000 evaluations for single-fit; 50,000 evaluations for combined fit. We chose different total number of evaluations for the calibration methods, to account for varying number of model parameters estimated during each individual calibration step. The optimization algorithm estimates model parameters by minimizing the residual sum of squares (RSS) of predicted and observed bloom dates. In a pre-trial we confirmed that by the end of the total number of model evaluations the RSS converged, indicating that the algorithm fails to find parameters providing better model performance.\n\nThese three notebooks perform the model calibration. The notebook for almond calibration has also some more comments on the different procedures. The notebooks for apricot and sweet cherry only contain the uncommented code.\n\n-   [Almond calibration](https://larscaspersen.github.io/combined-fitting-bloom/notebooks/02-calibrate-almond.html)\n\n-   [Apricot calibration](https://larscaspersen.github.io/combined-fitting-bloom/notebooks/03-calibrate-apricot.html)\n\n-   [Sweet Cherry calibration](https://larscaspersen.github.io/combined-fitting-bloom/notebooks/04-calibrate-cherry.html)\n\n### Model Evaluation\n\nThis code shows how the calibrated models are evaluated. This script generates figures and tables for the manuscript.\n\n[Generate figures for the manuscript](https://larscaspersen.github.io/combined-fitting-bloom/notebooks/05-make-figures.html)\n\n## References {.unnumbered}\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files\\figure-docx"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}